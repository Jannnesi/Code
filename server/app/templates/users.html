{% extends 'base.html' %}

{% block title %}Käyttäjähallinta{% endblock %}

{% block styles %}
<link rel="stylesheet" href="{{ url_for('static', filename='css/users.css') }}">
<link rel="stylesheet" href="{{ url_for('static', filename='css/flash.css') }}">
{% endblock %}

{% block content %}
{% include 'settings_flash.html' %}
<div class="container">
  <div class="user-grid">
    {% for u in users %}
    <form method="post" class="user-tile">
      <input type="hidden" name="csrf_token" value="{{ csrf_token() }}">
      <div class="user-info">
        <div class="field username">{{ u.username }}</div>
        <div class="field type">{% if u.is_temporary %}Väliaikainen{% else %}Pysyvä{% endif %}</div>
        <div class="field expires"><span class="expiry-date" data-raw="{{ u.expires_at }}">{% if u.expires_at %}{{ u.expires_at }}{% else %}-{% endif %}</span></div>
        <div class="field role">{% if u.is_admin %}<b>Admin</b>{% else %}–{% endif %}</div>
      </div>
      <div class="buttons">
        {# Enable editing only for non-admin users #}
        {% if not u.is_admin %}
          <a href="{{ url_for('web.edit_user', username=u.username) }}" class="edit-btn">Muokkaa</a>
        {% else %}
          <a href="#" class="edit-btn is-disabled" aria-disabled="true" tabindex="-1" onclick="return false;">Muokkaa</a>
        {% endif %}

        {# Disable delete for admin and self; backend also enforces this #}
        {% set is_self = (u.username == current_user.get_id()) %}
        <button
          {% if (not u.is_admin) and (not is_self) %}type="submit"{% else %}type="button" disabled{% endif %}
          name="delete_user"
          value="{{ u.username }}"
          class="delete-btn">
          Poista
        </button>
      </div>
    </form>
    {% endfor %}
    <a href="{{ url_for('web.add_user') }}" class="add-tile">Lisää käyttäjä</a>
  </div>
</div>
{% endblock %}

{% block scripts %}
<script src="{{ url_for('static', filename='js/users.js') }}"></script>
{% endblock %}
