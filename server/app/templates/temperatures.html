{% extends 'base.html' %}

{% block title %}Home Temperatures{% endblock %}

{% block styles %}
<link rel="stylesheet" href="{{ url_for('static', filename='css/temperatures.css') }}">
<link rel="stylesheet" href="{{ url_for('static', filename='css/flash.css') }}">
{% endblock %}

{% block content %}
<div class="container">
  {% with messages = get_flashed_messages(with_categories=true) %}
    {% if messages %}
    <div class="flash-container" style="max-width:800px; margin:0 auto 16px;">
      {% for category, msg in messages %}
      <div class="flash {{ category }}">{{ msg }}</div>
      {% endfor %}
    </div>
    {% endif %}
  {% endwith %}

  <div class="page-grid">
    <section class="card ac-card">
      <div class="card-header">
        <div>
          <h3 style="margin-bottom:4px;">AC</h3>
          <div class="status-row" aria-live="polite">
            <span id="acStatusPill" class="ac-pill ac-unknown">Unknown</span>
            <span id="thermoStatusPill" class="ac-pill ac-unknown">Thermostat —</span>
            <span id="sleepStatusPill" class="ac-pill ac-unknown">Sleep —</span>
          </div>
        </div>
        <div class="status-row rates" style="gap:6px; flex-wrap:wrap;">
          <span id="avgCoolingPill" class="ac-pill">Cooling: —</span>
          <span id="avgHeatingPill" class="ac-pill">Heat: —</span>
        </div>
      </div>
      <div class="card-body">
        <div class="ac-quick-grid">
          <div class="field">
            <label>Power</label>
            <button id="btnAcPowerToggle" class="btn w-100">Toggle AC</button>
          </div>
          <div class="field">
            <label>Target (°C)</label>
            <div class="stepper">
              <button id="btnSetpointDec" class="btn btn-step" aria-label="Decrease">−</button>
              <input class="field-input" id="setpointC" type="number" step="0.1" min="5" max="35" />
              <button id="btnSetpointInc" class="btn btn-step" aria-label="Increase">+</button>
            </div>
          </div>
          <div class="field">
            <label>Mode</label>
            <div class="segmented" role="group" aria-label="AC mode">
              <button id="modeCold" class="seg-btn" data-value="cold">Cold</button>
              <button id="modeWet"  class="seg-btn" data-value="wet">Dry</button>
              <button id="modeWind" class="seg-btn" data-value="wind">Fan</button>
            </div>
          </div>
          <div class="field">
            <label>Fan</label>
            <div class="segmented" role="group" aria-label="Fan speed">
              <button id="fanLow"  class="seg-btn" data-value="low">Low</button>
              <button id="fanHigh" class="seg-btn" data-value="high">High</button>
            </div>
          </div>
          <div class="field">
            <label>Thermostat</label>
            <button id="btnThermoToggle" class="btn w-100">Toggle Thermostat</button>
          </div>
        </div>

        <div class="divider"></div>
        <div class="settings-buttons">
          <button id="openSleepSettings" class="btn">Sleep settings</button>
          <button id="openThermoSettings" class="btn">Thermostat settings</button>
        </div>
      </div>
    </section>

    <section class="card readings-card">
      <div class="card-header">
        <div>
          <h3 style="margin-bottom:4px;">Lämpötila ja kosteus</h3>
        </div>
        <div class="status-row" style="gap:6px; flex-wrap:wrap;">
          <span id="avgTempPill" class="stat-pill">Keskiarvo: —</span>
          <span id="minTempPill" class="stat-pill">Min: —</span>
          <span id="maxTempPill" class="stat-pill">Max: —</span>
        </div>
      </div>
      <div class="card-body">
        <div class="toolbar">
          <input id="filterInput" class="search" type="text" placeholder="Suodata sijainteja..." aria-label="Suodata sijainteja">
          <div class="sort">
            <div class="segmented" role="group" aria-label="Järjestä">
              <button id="sortName" class="seg-btn" data-key="name">Nimi</button>
              <button id="sortTemp" class="seg-btn" data-key="temp">Lämpötila</button>
              <button id="sortHum"  class="seg-btn" data-key="hum">Kosteus</button>
              <button id="sortUpdated" class="seg-btn" data-key="updated">Aika</button>
            </div>
            <button id="sortDir" class="btn" title="Lajittelusuunta" aria-label="Lajittelusuunta">↑</button>
          </div>
        </div>
        <div id="locationsGrid" class="locations-grid"></div>
      </div>
    </section>
  </div>
</div>
{% include 'chart_modal.html' %}
{% include 'settings_modal.html' %}
{% endblock %}

{% block scripts %}
<script>
  window.LOCATIONS = {{ locations | tojson }};
</script>
<script src="{{ url_for('static', filename='js/init_sio.js') }}"></script>
<script src="{{ url_for('static', filename='js/temperatures.js') }}"></script>
<script src="{{ url_for('static', filename='js/flash.js') }}"></script>
{% endblock %}
