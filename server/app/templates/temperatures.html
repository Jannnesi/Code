{% extends 'base.html' %}

{% block title %}Home Temperatures{% endblock %}

{% block styles %}
<link rel="stylesheet" href="{{ url_for('static', filename='css/temperatures.css') }}">
<link rel="stylesheet" href="{{ url_for('static', filename='css/flash.css') }}">
{% endblock %}

{% block content %}
<div class="container">
  {% with messages = get_flashed_messages(with_categories=true) %}
    {% if messages %}
    <div class="flash-container" style="max-width:800px; margin:0 auto 16px;">
      {% for category, msg in messages %}
      <div class="flash {{ category }}">{{ msg }}</div>
      {% endfor %}
    </div>
    {% endif %}
  {% endwith %}

  <div class="page-grid">
    <section class="card ac-card">
      <div class="card-header">
        <h3>AC Control</h3>
        <div class="status-row">
          <span id="acStatusPill" class="ac-pill ac-unknown">Unknown</span>
          <span id="thermoStatusPill" class="ac-pill ac-unknown">Thermostat —</span>
          <span id="sleepStatusPill" class="ac-pill ac-unknown">Sleep —</span>
        </div>
        <div class="status-row" style="margin-top:6px; gap:6px; flex-wrap:wrap;">
          <span id="avgCoolingPill" class="ac-pill">Cooling: —</span>
          <span id="avgHeatingPill" class="ac-pill">Heat: —</span>
        </div>
      </div>
      <div class="card-body">
        <div class="controls-grid">
          <div class="field">
            <label for="acMode">Mode</label>
            <select id="acMode">
              <option value="cold">Cold</option>
              <option value="wet">Dry</option>
              <option value="wind">Fan</option>
            </select>
          </div>
          <div class="field">
            <label for="acFan">Fan</label>
            <select id="acFan">
              <option value="low">Low</option>
              <option value="high">High</option>
            </select>
          </div>
          <div class="field">
            <label>Power</label>
            <button id="btnAcPowerToggle" class="btn w-100">Toggle AC</button>
          </div>
          <div class="field">
            <label>Thermostat</label>
            <button id="btnThermoToggle" class="btn w-100">Toggle Thermostat</button>
          </div>
        </div>

        <div class="divider"></div>
        <div class="subsection">
          <div class="subheader">
            <h4>Sleep Schedule</h4>
          </div>
          <div class="controls-grid small">
            <div class="col-label">Action</div>
            <div class="col-label"><label for="sleepStart">Start</label></div>
            <div class="col-label"><label for="sleepStop">Stop</label></div>
            <div class="col-label">Save</div>
            <div class="field">
              <button id="btnSleepToggle" class="btn">Enable Sleep</button>
            </div>
            <div class="field">
              <input id="sleepStart" type="time" />
            </div>
            <div class="field">
              <input id="sleepStop" type="time" />
            </div>
            <div class="field">
              <button id="btnSleepSave" class="btn btn-icon" title="Save" aria-label="Save">
                <svg viewBox="0 0 24 24" width="16" height="16" aria-hidden="true" focusable="false">
                  <path fill="currentColor" d="M9 16.2l-3.5-3.5-1.4 1.4L9 19l10-10-1.4-1.4z"/>
                </svg>
              </button>
            </div>
          </div>
        </div>
        <details class="subsection">
          <summary class="subheader as-summary">Thermostat Settings</summary>
          <div class="controls-grid small">
            <div class="col-label"><label for="setpointC">Target (°C)</label></div>
            <div class="col-label"><label for="hysteresisNeg">-Hysteresis (°C)</label></div>
            <div class="col-label"><label for="hysteresisPos">+Hysteresis (°C)</label></div>
            <div class="col-label">Save</div>
            <div class="field">
              <input class="field-input" id="setpointC" type="number" step="0.1" min="5" max="35" />
            </div>
            <div class="field">
              <input class="field-input" id="hysteresisNeg" type="number" step="0.1" min="0.1" max="10" />
            </div>
            <div class="field">
              <input class="field-input" id="hysteresisPos" type="number" step="0.1" min="0.1" max="10" />
            </div>
            <div class="field">
              <button id="btnThermoSave" class="btn btn-icon" title="Save" aria-label="Save">
                <svg viewBox="0 0 24 24" width="16" height="16" aria-hidden="true" focusable="false">
                  <path fill="currentColor" d="M9 16.2l-3.5-3.5-1.4 1.4L9 19l10-10-1.4-1.4z"/>
                </svg>
              </button>
            </div>
          </div>
        </details>
      </div>
    </section>

    <section class="card readings-card">
      <div class="card-header">
        <h3>Lämpötila ja kosteus</h3>
      </div>
      <div class="card-body">
        <div id="locationsGrid" class="locations-grid"></div>
      </div>
    </section>
  </div>
</div>
{% include 'chart_modal.html' %}
{% endblock %}

{% block scripts %}
<script>
  window.LOCATIONS = {{ locations | tojson }};
</script>
<script src="{{ url_for('static', filename='js/init_sio.js') }}"></script>
<script src="{{ url_for('static', filename='js/temperatures.js') }}"></script>
<script src="{{ url_for('static', filename='js/flash.js') }}"></script>
{% endblock %}
