{% extends 'base.html' %}

{% block title %}Server Sensors{% endblock %}

{% block styles %}
<link rel="stylesheet" href="{{ url_for('static', filename='css/chart_modal.css') }}">
<link rel="stylesheet" href="{{ url_for('static', filename='css/temperatures.css') }}">
<link rel="stylesheet" href="{{ url_for('static', filename='css/flash.css') }}">
{% endblock %}

{% block content %}
<div class="container">
  {% with messages = get_flashed_messages(with_categories=true) %}
    {% if messages %}
    <div class="flash-container" style="max-width:800px; margin:0 auto 16px;">
      {% for category, msg in messages %}
      <div class="flash {{ category }}">{{ msg }}</div>
      {% endfor %}
    </div>
    {% endif %}
  {% endwith %}

  <div class="page-grid">
    <section class="card ac-card">
      <div class="card-header">
        <h3>AC Control</h3>
        <div class="status-row">
          <span id="acStatusPill" class="ac-pill ac-unknown">Unknown</span>
          <span id="thermoStatusPill" class="ac-pill ac-unknown">Thermostat —</span>
        </div>
      </div>
      <div class="card-body">
        <div class="controls-grid">
          <div class="field">
            <label for="acMode">Mode</label>
            <select id="acMode">
              <option value="cold">Cold</option>
              <option value="wet">Dry</option>
              <option value="wind">Fan</option>
            </select>
          </div>
          <div class="field">
            <label for="acFan">Fan</label>
            <select id="acFan">
              <option value="low">Low</option>
              <option value="high">High</option>
            </select>
          </div>
          <div class="field">
            <label>Power</label>
            <button id="btnAcPowerToggle" class="btn w-100">Toggle AC</button>
          </div>
          <div class="field">
            <label>Thermostat</label>
            <button id="btnThermoToggle" class="btn w-100">Toggle Thermostat</button>
          </div>
        </div>

        <div class="divider"></div>

        <div class="subsection">
          <div class="subheader">
            <h4>Sleep Schedule</h4>
          </div>
          <div class="controls-grid small">
            <div class="field checkbox">
              <input id="sleepEnabled" type="checkbox" />
              <label for="sleepEnabled">Enable Sleep</label>
            </div>
            <div class="field">
              <label for="sleepStart">Start</label>
              <input id="sleepStart" type="time" />
            </div>
            <div class="field">
              <label for="sleepStop">Stop</label>
              <input id="sleepStop" type="time" />
            </div>
            <div class="field align-end">
              <button id="btnSleepSave" class="btn w-100">Save</button>
            </div>
          </div>
        </div>

        <details class="subsection">
          <summary class="subheader as-summary">Thermostat Settings</summary>
          <div class="controls-grid small">
            <div class="field">
              <label for="setpointC">Setpoint (°C)</label>
              <input id="setpointC" type="number" step="0.1" min="5" max="35" />
            </div>
            <div class="field">
              <label for="hysteresis">Hysteresis (°C)</label>
              <input id="hysteresis" type="number" step="0.1" min="0.1" max="10" />
            </div>
            <div class="field align-end">
              <button id="btnThermoSave" class="btn w-100">Save</button>
            </div>
          </div>
        </details>
      </div>
    </section>

    <section class="card readings-card">
      <div class="card-header">
        <h3>Lämpötila ja kosteus</h3>
      </div>
      <div class="card-body">
        <div id="locationsGrid" class="locations-grid"></div>
      </div>
    </section>
  </div>
</div>
{% include 'chart_modal.html' %}
{% endblock %}

{% block scripts %}
<script>
  window.LOCATIONS = {{ locations | tojson }};
</script>
<script src="{{ url_for('static', filename='js/chart_modal.js') }}"></script>
<script src="{{ url_for('static', filename='js/init_sio.js') }}"></script>
<script src="{{ url_for('static', filename='js/temperatures.js') }}"></script>
<script src="{{ url_for('static', filename='js/flash.js') }}"></script>
{% endblock %}
